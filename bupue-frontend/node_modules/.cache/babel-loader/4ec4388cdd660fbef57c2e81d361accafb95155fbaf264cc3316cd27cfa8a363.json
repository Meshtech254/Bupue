{"ast":null,"code":"import _objectSpread from\"C:/Users/chapl/bupue/bupue-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState}from'react';import{useParams,useNavigate}from'react-router-dom';import axios from'axios';import CommentList from'../comments/CommentList';import CreateComment from'../comments/CreateComment';import'./Posts.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const PostDetail=()=>{var _post$author,_post$author2;const{id}=useParams();const navigate=useNavigate();const[post,setPost]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[refresh,setRefresh]=useState(false);const[editing,setEditing]=useState(false);const[editForm,setEditForm]=useState({title:'',body:''});const[editError,setEditError]=useState('');const user=JSON.parse(localStorage.getItem('user')||'null');useEffect(()=>{const fetchPost=async()=>{try{const res=await axios.get(\"/api/events/\".concat(id));setPost(res.data);}catch(err){setError('Failed to load event');}finally{setLoading(false);}};fetchPost();},[id,refresh]);const handleCommentAdded=()=>setRefresh(r=>!r);const isAuthor=user&&post&&user.id===((_post$author=post.author)===null||_post$author===void 0?void 0:_post$author._id);const handleEdit=()=>{setEditForm({title:post.title,body:post.body});setEditing(true);setEditError('');};const handleEditChange=e=>{setEditForm(_objectSpread(_objectSpread({},editForm),{},{[e.target.name]:e.target.value}));};const handleEditSubmit=async e=>{e.preventDefault();try{const token=localStorage.getItem('token');await axios.put(\"/api/events/\".concat(id),editForm,{headers:{Authorization:\"Bearer \".concat(token)}});setEditing(false);setRefresh(r=>!r);}catch(err){var _err$response,_err$response$data;setEditError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'Failed to update event');}};const handleDelete=async()=>{if(!window.confirm('Are you sure you want to delete this event?'))return;try{const token=localStorage.getItem('token');await axios.delete(\"/api/events/\".concat(id),{headers:{Authorization:\"Bearer \".concat(token)}});navigate('/events');}catch(err){alert('Failed to delete event');}};if(loading)return/*#__PURE__*/_jsx(\"div\",{children:\"Loading event...\"});if(error)return/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:error});if(!post)return/*#__PURE__*/_jsx(\"div\",{children:\"Event not found.\"});return/*#__PURE__*/_jsxs(\"div\",{className:\"event-detail-container\",children:[editing?/*#__PURE__*/_jsxs(\"form\",{className:\"edit-event-form\",onSubmit:handleEditSubmit,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"title\",value:editForm.title,onChange:handleEditChange,required:true}),/*#__PURE__*/_jsx(\"textarea\",{name:\"body\",value:editForm.body,onChange:handleEditChange,required:true}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Save\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setEditing(false),children:\"Cancel\"}),editError&&/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:editError})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h2\",{children:post.title}),/*#__PURE__*/_jsxs(\"div\",{className:\"event-meta\",children:[\"By \",((_post$author2=post.author)===null||_post$author2===void 0?void 0:_post$author2.username)||'Unknown',\" | \",new Date(post.createdAt).toLocaleString()]}),/*#__PURE__*/_jsx(\"div\",{className:\"event-body\",children:post.body}),isAuthor&&/*#__PURE__*/_jsxs(\"div\",{className:\"event-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleEdit,children:\"Edit\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleDelete,className:\"danger\",children:\"Delete\"})]})]}),/*#__PURE__*/_jsx(CreateComment,{postId:id,onCommentAdded:handleCommentAdded}),/*#__PURE__*/_jsx(CommentList,{postId:id},refresh)]});};export default PostDetail;","map":{"version":3,"names":["React","useEffect","useState","useParams","useNavigate","axios","CommentList","CreateComment","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","PostDetail","_post$author","_post$author2","id","navigate","post","setPost","loading","setLoading","error","setError","refresh","setRefresh","editing","setEditing","editForm","setEditForm","title","body","editError","setEditError","user","JSON","parse","localStorage","getItem","fetchPost","res","get","concat","data","err","handleCommentAdded","r","isAuthor","author","_id","handleEdit","handleEditChange","e","_objectSpread","target","name","value","handleEditSubmit","preventDefault","token","put","headers","Authorization","_err$response","_err$response$data","response","message","handleDelete","window","confirm","delete","alert","children","className","onSubmit","type","onChange","required","onClick","username","Date","createdAt","toLocaleString","postId","onCommentAdded"],"sources":["C:/Users/chapl/bupue/bupue-frontend/src/components/posts/PostDetail.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport CommentList from '../comments/CommentList';\r\nimport CreateComment from '../comments/CreateComment';\r\nimport './Posts.css';\r\n\r\nconst PostDetail = () => {\r\n  const { id } = useParams();\r\n  const navigate = useNavigate();\r\n  const [post, setPost] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [refresh, setRefresh] = useState(false);\r\n  const [editing, setEditing] = useState(false);\r\n  const [editForm, setEditForm] = useState({ title: '', body: '' });\r\n  const [editError, setEditError] = useState('');\r\n\r\n  const user = JSON.parse(localStorage.getItem('user') || 'null');\r\n\r\n  useEffect(() => {\r\n    const fetchPost = async () => {\r\n      try {\r\n        const res = await axios.get(`/api/events/${id}`);\r\n        setPost(res.data);\r\n      } catch (err) {\r\n        setError('Failed to load event');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchPost();\r\n  }, [id, refresh]);\r\n\r\n  const handleCommentAdded = () => setRefresh(r => !r);\r\n\r\n  const isAuthor = user && post && user.id === post.author?._id;\r\n\r\n  const handleEdit = () => {\r\n    setEditForm({ title: post.title, body: post.body });\r\n    setEditing(true);\r\n    setEditError('');\r\n  };\r\n\r\n  const handleEditChange = e => {\r\n    setEditForm({ ...editForm, [e.target.name]: e.target.value });\r\n  };\r\n\r\n  const handleEditSubmit = async e => {\r\n    e.preventDefault();\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      await axios.put(`/api/events/${id}`, editForm, {\r\n        headers: { Authorization: `Bearer ${token}` }\r\n      });\r\n      setEditing(false);\r\n      setRefresh(r => !r);\r\n    } catch (err) {\r\n      setEditError(err.response?.data?.message || 'Failed to update event');\r\n    }\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    if (!window.confirm('Are you sure you want to delete this event?')) return;\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      await axios.delete(`/api/events/${id}`, {\r\n        headers: { Authorization: `Bearer ${token}` }\r\n      });\r\n      navigate('/events');\r\n    } catch (err) {\r\n      alert('Failed to delete event');\r\n    }\r\n  };\r\n\r\n  if (loading) return <div>Loading event...</div>;\r\n  if (error) return <div className=\"error\">{error}</div>;\r\n  if (!post) return <div>Event not found.</div>;\r\n\r\n  return (\r\n    <div className=\"event-detail-container\">\r\n      {editing ? (\r\n        <form className=\"edit-event-form\" onSubmit={handleEditSubmit}>\r\n          <input\r\n            type=\"text\"\r\n            name=\"title\"\r\n            value={editForm.title}\r\n            onChange={handleEditChange}\r\n            required\r\n          />\r\n          <textarea\r\n            name=\"body\"\r\n            value={editForm.body}\r\n            onChange={handleEditChange}\r\n            required\r\n          />\r\n          <button type=\"submit\">Save</button>\r\n          <button type=\"button\" onClick={() => setEditing(false)}>Cancel</button>\r\n          {editError && <div className=\"error\">{editError}</div>}\r\n        </form>\r\n      ) : (\r\n        <>\r\n          <h2>{post.title}</h2>\r\n          <div className=\"event-meta\">By {post.author?.username || 'Unknown'} | {new Date(post.createdAt).toLocaleString()}</div>\r\n          <div className=\"event-body\">{post.body}</div>\r\n          {isAuthor && (\r\n            <div className=\"event-actions\">\r\n              <button onClick={handleEdit}>Edit</button>\r\n              <button onClick={handleDelete} className=\"danger\">Delete</button>\r\n            </div>\r\n          )}\r\n        </>\r\n      )}\r\n      <CreateComment postId={id} onCommentAdded={handleCommentAdded} />\r\n      <CommentList key={refresh} postId={id} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PostDetail; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}