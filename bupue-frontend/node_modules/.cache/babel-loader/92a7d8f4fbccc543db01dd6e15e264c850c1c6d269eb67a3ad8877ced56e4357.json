{"ast":null,"code":"import _objectSpread from\"C:/Users/chapl/bupue/bupue-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState}from'react';import{useNavigate}from'react-router-dom';import{useCart}from'../../context/CartContext';import{loadStripe}from'@stripe/stripe-js';import{Elements}from'@stripe/react-stripe-js';import PaymentForm from'./PaymentForm';import apiClient from'../../api/client';import'./Cart.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const stripePromise=loadStripe(process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY||'pk_test_51H1234567890');const Checkout=()=>{const{cart,clearCart}=useCart();const[shipping,setShipping]=useState({name:'',address:'',city:'',country:'',postalCode:''});const[error,setError]=useState('');const[loading,setLoading]=useState(false);const[step,setStep]=useState('shipping');// 'shipping' or 'payment'\nconst[orderId,setOrderId]=useState(null);const[clientSecret,setClientSecret]=useState(null);const navigate=useNavigate();const total=cart.reduce((sum,i)=>sum+i.item.price*i.quantity,0);const handleChange=e=>{setShipping(_objectSpread(_objectSpread({},shipping),{},{[e.target.name]:e.target.value}));};const handleShippingSubmit=async e=>{e.preventDefault();setLoading(true);setError('');try{// Create order first\nconst items=cart.map(i=>({item:i.item._id,quantity:i.quantity}));const orderResponse=await apiClient.post('/api/orders',{items,shipping});setOrderId(orderResponse.data._id);// Create payment intent\nconst paymentResponse=await apiClient.post('/api/payments/create-payment-intent',{amount:total,orderId:orderResponse.data._id});setClientSecret(paymentResponse.data.clientSecret);setStep('payment');}catch(err){var _err$response,_err$response$data;setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'Failed to create order');}finally{setLoading(false);}};const handlePaymentSuccess=()=>{clearCart();navigate('/orders?success=true');};const handlePaymentError=errorMessage=>{setError(errorMessage);};if(cart.length===0){return/*#__PURE__*/_jsx(\"div\",{className:\"cart-container\",children:\"Your cart is empty.\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"cart-container\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Checkout\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"cart-total\",children:[\"Order Total: \",/*#__PURE__*/_jsxs(\"strong\",{children:[\"$\",total.toFixed(2)]})]}),step==='shipping'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Shipping Information\"}),/*#__PURE__*/_jsxs(\"form\",{className:\"checkout-form\",onSubmit:handleShippingSubmit,children:[/*#__PURE__*/_jsx(\"input\",{name:\"name\",placeholder:\"Full Name\",value:shipping.name,onChange:handleChange,required:true}),/*#__PURE__*/_jsx(\"input\",{name:\"address\",placeholder:\"Address\",value:shipping.address,onChange:handleChange,required:true}),/*#__PURE__*/_jsx(\"input\",{name:\"city\",placeholder:\"City\",value:shipping.city,onChange:handleChange,required:true}),/*#__PURE__*/_jsx(\"input\",{name:\"country\",placeholder:\"Country\",value:shipping.country,onChange:handleChange,required:true}),/*#__PURE__*/_jsx(\"input\",{name:\"postalCode\",placeholder:\"Postal Code\",value:shipping.postalCode,onChange:handleChange,required:true}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading,children:loading?'Creating Order...':'Continue to Payment'}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:error})]})]}),step==='payment'&&clientSecret&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Payment Information\"}),/*#__PURE__*/_jsx(\"div\",{className:\"payment-methods\",children:/*#__PURE__*/_jsx(Elements,{stripe:stripePromise,children:/*#__PURE__*/_jsx(PaymentForm,{clientSecret:clientSecret,orderId:orderId,onSuccess:handlePaymentSuccess,onError:handlePaymentError})})}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:error}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"back-button\",onClick:()=>setStep('shipping'),children:\"Back to Shipping\"})]})]});};export default Checkout;","map":{"version":3,"names":["React","useState","useNavigate","useCart","loadStripe","Elements","PaymentForm","apiClient","jsx","_jsx","jsxs","_jsxs","stripePromise","process","env","REACT_APP_STRIPE_PUBLISHABLE_KEY","Checkout","cart","clearCart","shipping","setShipping","name","address","city","country","postalCode","error","setError","loading","setLoading","step","setStep","orderId","setOrderId","clientSecret","setClientSecret","navigate","total","reduce","sum","i","item","price","quantity","handleChange","e","_objectSpread","target","value","handleShippingSubmit","preventDefault","items","map","_id","orderResponse","post","data","paymentResponse","amount","err","_err$response","_err$response$data","response","message","handlePaymentSuccess","handlePaymentError","errorMessage","length","className","children","toFixed","onSubmit","placeholder","onChange","required","type","disabled","stripe","onSuccess","onError","onClick"],"sources":["C:/Users/chapl/bupue/bupue-frontend/src/components/cart/Checkout.js"],"sourcesContent":["import React, { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useCart } from '../../context/CartContext';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Elements } from '@stripe/react-stripe-js';\nimport PaymentForm from './PaymentForm';\nimport apiClient from '../../api/client';\nimport './Cart.css';\n\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY || 'pk_test_51H1234567890');\n\nconst Checkout = () => {\n  const { cart, clearCart } = useCart();\n  const [shipping, setShipping] = useState({ name: '', address: '', city: '', country: '', postalCode: '' });\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [step, setStep] = useState('shipping'); // 'shipping' or 'payment'\n  const [orderId, setOrderId] = useState(null);\n  const [clientSecret, setClientSecret] = useState(null);\n  const navigate = useNavigate();\n\n  const total = cart.reduce((sum, i) => sum + i.item.price * i.quantity, 0);\n\n  const handleChange = e => {\n    setShipping({ ...shipping, [e.target.name]: e.target.value });\n  };\n\n  const handleShippingSubmit = async e => {\n    e.preventDefault();\n    setLoading(true);\n    setError('');\n    try {\n      // Create order first\n      const items = cart.map(i => ({ item: i.item._id, quantity: i.quantity }));\n      const orderResponse = await apiClient.post('/api/orders', { items, shipping });\n      setOrderId(orderResponse.data._id);\n      \n      // Create payment intent\n      const paymentResponse = await apiClient.post('/api/payments/create-payment-intent', {\n        amount: total,\n        orderId: orderResponse.data._id\n      });\n      setClientSecret(paymentResponse.data.clientSecret);\n      setStep('payment');\n    } catch (err) {\n      setError(err.response?.data?.message || 'Failed to create order');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handlePaymentSuccess = () => {\n    clearCart();\n    navigate('/orders?success=true');\n  };\n\n  const handlePaymentError = (errorMessage) => {\n    setError(errorMessage);\n  };\n\n  if (cart.length === 0) {\n    return <div className=\"cart-container\">Your cart is empty.</div>;\n  }\n\n  return (\n    <div className=\"cart-container\">\n      <h2>Checkout</h2>\n      <div className=\"cart-total\">Order Total: <strong>${total.toFixed(2)}</strong></div>\n      \n      {step === 'shipping' && (\n        <div>\n          <h3>Shipping Information</h3>\n          <form className=\"checkout-form\" onSubmit={handleShippingSubmit}>\n            <input name=\"name\" placeholder=\"Full Name\" value={shipping.name} onChange={handleChange} required />\n            <input name=\"address\" placeholder=\"Address\" value={shipping.address} onChange={handleChange} required />\n            <input name=\"city\" placeholder=\"City\" value={shipping.city} onChange={handleChange} required />\n            <input name=\"country\" placeholder=\"Country\" value={shipping.country} onChange={handleChange} required />\n            <input name=\"postalCode\" placeholder=\"Postal Code\" value={shipping.postalCode} onChange={handleChange} required />\n            <button type=\"submit\" disabled={loading}>\n              {loading ? 'Creating Order...' : 'Continue to Payment'}\n            </button>\n            {error && <div className=\"error\">{error}</div>}\n          </form>\n        </div>\n      )}\n\n      {step === 'payment' && clientSecret && (\n        <div>\n          <h3>Payment Information</h3>\n          <div className=\"payment-methods\">\n            <Elements stripe={stripePromise}>\n              <PaymentForm\n                clientSecret={clientSecret}\n                orderId={orderId}\n                onSuccess={handlePaymentSuccess}\n                onError={handlePaymentError}\n              />\n            </Elements>\n          </div>\n          {error && <div className=\"error\">{error}</div>}\n          <button \n            type=\"button\" \n            className=\"back-button\"\n            onClick={() => setStep('shipping')}\n          >\n            Back to Shipping\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Checkout;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}