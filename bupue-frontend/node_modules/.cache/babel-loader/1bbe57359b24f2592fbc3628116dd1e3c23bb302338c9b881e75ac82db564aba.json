{"ast":null,"code":"import React,{useEffect,useState}from'react';import axios from'axios';import'./Comments.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const CommentList=_ref=>{let{postId}=_ref;const[comments,setComments]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[editingId,setEditingId]=useState(null);const[editText,setEditText]=useState('');const[editError,setEditError]=useState('');const user=JSON.parse(localStorage.getItem('user')||'null');const fetchComments=async()=>{try{const res=await axios.get(\"/api/events/\".concat(postId,\"/comments\"));setComments(res.data);}catch(err){setError('Failed to load comments');}finally{setLoading(false);}};useEffect(()=>{fetchComments();// eslint-disable-next-line\n},[postId]);const isAuthor=comment=>user&&comment.author&&user.id===comment.author._id;const handleEdit=comment=>{setEditingId(comment._id);setEditText(comment.text);setEditError('');};const handleEditChange=e=>setEditText(e.target.value);const handleEditSubmit=async(e,commentId)=>{e.preventDefault();try{const token=localStorage.getItem('token');await axios.put(\"/api/events/\".concat(postId,\"/comments/\").concat(commentId),{text:editText},{headers:{Authorization:\"Bearer \".concat(token)}});setEditingId(null);fetchComments();}catch(err){var _err$response,_err$response$data;setEditError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'Failed to update comment');}};const handleDelete=async commentId=>{if(!window.confirm('Are you sure you want to delete this comment?'))return;try{const token=localStorage.getItem('token');await axios.delete(\"/api/events/\".concat(postId,\"/comments/\").concat(commentId),{headers:{Authorization:\"Bearer \".concat(token)}});fetchComments();}catch(err){alert('Failed to delete comment');}};if(loading)return/*#__PURE__*/_jsx(\"div\",{children:\"Loading comments...\"});if(error)return/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:error});return/*#__PURE__*/_jsxs(\"div\",{className:\"comments-list\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Comments\"}),comments.length===0&&/*#__PURE__*/_jsx(\"div\",{children:\"No comments yet.\"}),comments.map(comment=>{var _comment$author;return/*#__PURE__*/_jsxs(\"div\",{className:\"comment-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"comment-author\",children:((_comment$author=comment.author)===null||_comment$author===void 0?void 0:_comment$author.username)||'Unknown'}),editingId===comment._id?/*#__PURE__*/_jsxs(\"form\",{className:\"edit-comment-form\",onSubmit:e=>handleEditSubmit(e,comment._id),children:[/*#__PURE__*/_jsx(\"textarea\",{value:editText,onChange:handleEditChange,required:true}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Save\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setEditingId(null),children:\"Cancel\"}),editError&&/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:editError})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"comment-text\",children:comment.text}),/*#__PURE__*/_jsx(\"div\",{className:\"comment-date\",children:new Date(comment.createdAt).toLocaleString()}),isAuthor(comment)&&/*#__PURE__*/_jsxs(\"div\",{className:\"comment-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleEdit(comment),children:\"Edit\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDelete(comment._id),className:\"danger\",children:\"Delete\"})]})]})]},comment._id);})]});};export default CommentList;","map":{"version":3,"names":["React","useEffect","useState","axios","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","CommentList","_ref","postId","comments","setComments","loading","setLoading","error","setError","editingId","setEditingId","editText","setEditText","editError","setEditError","user","JSON","parse","localStorage","getItem","fetchComments","res","get","concat","data","err","isAuthor","comment","author","id","_id","handleEdit","text","handleEditChange","e","target","value","handleEditSubmit","commentId","preventDefault","token","put","headers","Authorization","_err$response","_err$response$data","response","message","handleDelete","window","confirm","delete","alert","children","className","length","map","_comment$author","username","onSubmit","onChange","required","type","onClick","Date","createdAt","toLocaleString"],"sources":["C:/Users/chapl/bupue/bupue-frontend/src/components/comments/CommentList.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport axios from 'axios';\r\nimport './Comments.css';\r\n\r\nconst CommentList = ({ postId }) => {\r\n  const [comments, setComments] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [editingId, setEditingId] = useState(null);\r\n  const [editText, setEditText] = useState('');\r\n  const [editError, setEditError] = useState('');\r\n\r\n  const user = JSON.parse(localStorage.getItem('user') || 'null');\r\n\r\n  const fetchComments = async () => {\r\n    try {\r\n      const res = await axios.get(`/api/events/${postId}/comments`);\r\n      setComments(res.data);\r\n    } catch (err) {\r\n      setError('Failed to load comments');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchComments();\r\n    // eslint-disable-next-line\r\n  }, [postId]);\r\n\r\n  const isAuthor = (comment) => user && comment.author && user.id === comment.author._id;\r\n\r\n  const handleEdit = (comment) => {\r\n    setEditingId(comment._id);\r\n    setEditText(comment.text);\r\n    setEditError('');\r\n  };\r\n\r\n  const handleEditChange = (e) => setEditText(e.target.value);\r\n\r\n  const handleEditSubmit = async (e, commentId) => {\r\n    e.preventDefault();\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      await axios.put(`/api/events/${postId}/comments/${commentId}`, { text: editText }, {\r\n        headers: { Authorization: `Bearer ${token}` }\r\n      });\r\n      setEditingId(null);\r\n      fetchComments();\r\n    } catch (err) {\r\n      setEditError(err.response?.data?.message || 'Failed to update comment');\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (commentId) => {\r\n    if (!window.confirm('Are you sure you want to delete this comment?')) return;\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      await axios.delete(`/api/events/${postId}/comments/${commentId}`, {\r\n        headers: { Authorization: `Bearer ${token}` }\r\n      });\r\n      fetchComments();\r\n    } catch (err) {\r\n      alert('Failed to delete comment');\r\n    }\r\n  };\r\n\r\n  if (loading) return <div>Loading comments...</div>;\r\n  if (error) return <div className=\"error\">{error}</div>;\r\n\r\n  return (\r\n    <div className=\"comments-list\">\r\n      <h4>Comments</h4>\r\n      {comments.length === 0 && <div>No comments yet.</div>}\r\n      {comments.map(comment => (\r\n        <div key={comment._id} className=\"comment-item\">\r\n          <div className=\"comment-author\">{comment.author?.username || 'Unknown'}</div>\r\n          {editingId === comment._id ? (\r\n            <form className=\"edit-comment-form\" onSubmit={e => handleEditSubmit(e, comment._id)}>\r\n              <textarea value={editText} onChange={handleEditChange} required />\r\n              <button type=\"submit\">Save</button>\r\n              <button type=\"button\" onClick={() => setEditingId(null)}>Cancel</button>\r\n              {editError && <div className=\"error\">{editError}</div>}\r\n            </form>\r\n          ) : (\r\n            <>\r\n              <div className=\"comment-text\">{comment.text}</div>\r\n              <div className=\"comment-date\">{new Date(comment.createdAt).toLocaleString()}</div>\r\n              {isAuthor(comment) && (\r\n                <div className=\"comment-actions\">\r\n                  <button onClick={() => handleEdit(comment)}>Edit</button>\r\n                  <button onClick={() => handleDelete(comment._id)} className=\"danger\">Delete</button>\r\n                </div>\r\n              )}\r\n            </>\r\n          )}\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CommentList; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}